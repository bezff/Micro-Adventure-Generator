<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор Микро-Приключений</title>
    <style>
        :root {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e0e0e0;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a4a;
            --accent: #ff6b6b;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-strong: rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] {
            --bg-primary: #0f0f1e;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --text-primary: #eaeaea;
            --text-secondary: #b4b4b4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: all 0.3s ease;
        }

        #mapCanvas {
            position: fixed !important;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1 !important; 
            opacity: 0.3;
            pointer-events: none !important;
        }

        .container {
            position: relative;
            z-index: 100;
            width: 100%;
            max-width: 600px;
        }

        .main-panel {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px var(--shadow-strong);
            position: relative;
            z-index: 100;
        }

        .title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-primary {
            width: 100%;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            background: var(--gradient);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 100;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .quest-card {
            margin-bottom: 30px;
        }

        .quest-card.hidden {
            display: none;
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quest-number {
            background: var(--gradient);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .quest-block {
            display: flex;
            gap: 16px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 16px;
            border-left: 4px solid var(--accent);
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .quest-block:hover {
            transform: translateX(4px);
        }

        .block-icon {
            font-size: 2em;
        }

        .block-content h3 {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .block-content p {
            font-size: 1.1em;
            line-height: 1.5;
        }

        .quest-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn-secondary {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            font-size: 0.9em;
            color: var(--text-primary);
            background: var(--bg-tertiary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer !important;
            transition: all 0.3s ease;
            position: relative;
            z-index: 100;
        }

        .btn-secondary:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            transform: translateY(-2px);
        }

        .btn-secondary:active {
            transform: scale(0.98);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            padding: 24px;
            background: var(--bg-primary);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 2em;
            font-weight: bold;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            display: block;
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .journal-toggle {
            width: 100%;
            padding: 16px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 12px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 100;
        }

        .journal-toggle:hover {
            background: var(--accent);
            color: white;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(20deg);
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 8px 24px var(--shadow-strong);
            z-index: 4000;
            transition: all 0.3s ease;
        }

        .notification.hidden {
            display: none;
        }

        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }

        .loader.hidden {
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--bg-tertiary);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        button, a, .btn-primary, .btn-secondary, .journal-toggle, .theme-toggle {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative;
            z-index: 100;
        }
        .journal-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            max-width: 100%;
            height: 100vh;
            background: var(--bg-secondary);
            box-shadow: -4px 0 20px var(--shadow-strong);
            z-index: 2000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .journal-panel:not(.hidden) {
            right: 0;
        }

        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 2px solid var(--bg-tertiary);
        }

        .journal-header h2 {
            font-size: 1.5em;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-primary);
            line-height: 1;
            transition: all 0.3s ease;
            padding: 0;
            width: 40px;
            height: 40px;
        }

        .close-btn:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }

        .journal-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .journal-entry {
            padding: 16px;
            background: var(--bg-primary);
            border-radius: 12px;
            margin-bottom: 16px;
            border-left: 4px solid var(--accent);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
           from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .journal-entry.completed {
            border-left-color: #51cf66;
        }

        .journal-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

         .journal-entry-date {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .journal-entry-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .journal-entry-status.completed {
            background: #51cf66;
            color: white;
        }

        .journal-entry-status.pending {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .journal-entry-content {
            font-size: 0.9em;
            line-height: 1.6;
        }

        .journal-entry-content strong {
            display: block;
            margin-bottom: 4px;
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            padding: 60px 20px;
            font-size: 1.1em;
        }

        .btn-danger {
             margin: 16px;
            padding: 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

         .btn-danger:hover {
             background: #ee5a52;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .journal-panel {
                right: -100%;
             width: 100%;
           }
        }

        .creator-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .creator-panel {
            background: var(--bg-secondary);
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .creator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 2px solid var(--bg-tertiary);
        }

        .creator-header h2 {
            margin: 0;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .creator-content {
            padding: 24px;
        }

        .creator-section {
            margin-bottom: 24px;
        }

        .creator-section h3 {
            font-size: 1em;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .creator-section input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .creator-section input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .custom-list {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--bg-tertiary);
        }

        .custom-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .custom-item-text {
            flex: 1;
            margin-right: 12px;
        }

        .custom-item-badge {
            padding: 4px 12px;
            background: var(--accent);
            color: white;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 8px;
        }

        .custom-item-delete {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 1.2em;
            padding: 4px 8px;
        }

        .custom-item-delete:hover {
            color: #ee5a52;
        }
    </style>
</head>
<div class="journal-panel hidden" id="journalPanel">
    <div class="journal-header">
        <h2>📖 Журнал Приключений</h2>
        <button class="close-btn" onclick="toggleJournal()">×</button>
    </div>
    <div class="journal-content" id="journalContent">
        <p class="empty-state">Ваши приключения появятся здесь...</p>
    </div>
    <button class="btn-danger" onclick="clearJournal()">🗑️ Очистить журнал</button>
</div>
<div class="creator-mode hidden" id="creatorMode">
    <div class="creator-panel">
        <div class="creator-header">
            <h2>🎨 Режим Создателя</h2>
            <button class="close-btn" onclick="closeCreator()">×</button>
        </div>
        
        <div class="creator-content">
            <div class="creator-section">
                <h3>➕ Добавить новое место</h3>
                <input type="text" id="newPlace" placeholder="Например: Вершина заснеженной горы">
            </div>

            <div class="creator-section">
                <h3>➕ Добавить новое действие</h3>
                <input type="text" id="newAction" placeholder="Например: Спой песню ветру">
            </div>

            <div class="creator-section">
                <h3>➕ Добавить новое условие</h3>
                <input type="text" id="newCondition" placeholder="Например: Только на рассвете">
            </div>

            <button class="btn-primary" onclick="addCustomContent()" style="margin-top: 20px;">
                💾 Добавить в базу
            </button>

            <div class="custom-list" id="customList"></div>
        </div>
    </div>
</div>

<body>
    <canvas id="mapCanvas"></canvas>

    <button class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">🌙</span>
    </button>

    <div class="container">
        <div class="main-panel">
            <h1 class="title">🗺️ Генератор Приключений</h1>
            
            <button class="btn-primary" onclick="generateQuest()">
                Мне скучно
            </button>

            <div class="quest-card hidden" id="questCard">
                <div class="quest-header">
                    <h2>Ваше Приключение</h2>
                    <span class="quest-number">#<span id="questNumber">1</span></span>
                </div>

                <div class="quest-block">
                    <div class="block-icon">📍</div>
                    <div class="block-content">
                        <h3>Место</h3>
                        <p id="questPlace">...</p>
                    </div>
                </div>

                <div class="quest-block">
                    <div class="block-icon">⚡</div>
                    <div class="block-content">
                        <h3>Действие</h3>
                        <p id="questAction">...</p>
                    </div>
                </div>

                <div class="quest-block">
                    <div class="block-icon">🎯</div>
                    <div class="block-content">
                        <h3>Условие</h3>
                        <p id="questCondition">...</p>
                    </div>
                </div>

                <div class="quest-actions">
                    <button class="btn-secondary" onclick="completeQuest()">✓ Выполнено</button>
                    <button class="btn-secondary" onclick="exportQuest()">📄 Экспорт</button>
                    <button class="btn-secondary" onclick="shareQuest()">🔗 Поделиться</button>
                </div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <span class="stat-value" id="totalQuests">0</span>
                    <span class="stat-label">Всего квестов</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="completedQuests">0</span>
                    <span class="stat-label">Выполнено</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="uniquePlaces">0</span>
                    <span class="stat-label">Мест посещено</span>
                </div>
            </div>

            <button class="journal-toggle" onclick="toggleJournal()">
            📖 Журнал приключений
            </button>
        </div>
    </div>

    <div class="notification hidden" id="notification"></div>
    <div class="loader hidden" id="loader">
        <div class="spinner"></div>
    </div>

    <script>
        let currentQuest = null;
        let journal = JSON.parse(localStorage.getItem('adventureJournal') || '[]');

        const places = [
            'Заброшенный маяк на скалистом берегу',
            'Тихий сад за старой библиотекой',
            'Крыша небоскрёба в центре города',
            'Лесная поляна с грибным кольцом',
            'Подвал антикварного магазина',
            'Мост через замёрзшую реку',
            'Заброшенная железнодорожная станция',
            'Берег озера на рассвете',
            'Старое кладбище с каменными ангелами',
            'Пещера с подземным водопадом',
            'Крыша многоэтажки на рассвете',
            'Подземный переход с граффити',
            'Старое кладбище с каменными ангелами',
            'Забытая детская площадка в лесу',
            'Мост над замерзшей рекой',
            'Заброшенная железнодорожная станция',
            'Пещера с эхом у водопада',
            'Чердак викторианского особняка',
            'Лавандовое поле на закате',
            'Антикварный магазин на узкой улочке',
            'Смотровая площадка над городом',
            'Подвал старой церкви',
            'Песчаная дюна в пустыне',
            'Ботанический сад в тумане',
            'Заброшенный кинотеатр',
            'Маленький остров посреди озера',
            'Башня с часами в полночь',
            'Бамбуковая роща',
            'Старая ветряная мельница',
            'Пирс во время шторма',
            'Подземелье средневекового замка',
            'Оранжерея с тропическими растениями',
            'Заброшенная обсерватория',
            'Лабиринт из живой изгороди',
            'Ледяная пещера в горах',
            'Старый книжный развал',
            'Колокольня с видом на долину',
            'Заброшенный бассейн',
            'Поляна с каменным кругом',
            'Старая водонапорная башня',
            'Подвесной мост в джунглях',
            'Заброшенная фабрика',
            'Сакуровый парк весной',
            'Старая телефонная будка',
            'Пещера со сталактитами',
            'Крепостная стена древнего города',
            'Заброшенный санаторий',
            'Поле подсолнухов',
            'Старая водяная мельница',
            'Вершина холма с дольменами',
            'Туннель, увитый плющом',
            'Заброшенная часовня',
            'Соляная пещера',
            'Старый трамвайный парк',
            'Мангровые заросли',
            'Заброшенная школа',
            'Лунная поляна в ельнике',
            'Старый фонтан в парке',
            'Геотермальный источник',
            'Заброшенная винодельня',
            'Скалы причудливой формы',
            'Старая башня-руина',
            'Цветочный рынок на рассвете',
            'Заброшенный тоннель метро',
            'Болотистая местность с кочками',
            'Старая кузница',
            'Заброшенный отель',
            'Поляна с грибными кругами',
            'Старый каменный карьер',
            'Заброшенный причал',
            'Пещера с подземным озером',
            'Старая пожарная каланча',
            'Заброшенная радиостанция',
            'Поляна с дикими орхидеями',
            'Старый амбар',
            'Заброшенная больница',
            'Каньон с красными скалами',
            'Старая почтовая станция',
            'Заброшенная теплица',
            'Поле лаванды после дождя',
            'Старый колодец с ведром',
            'Заброшенная таможня у границы',
            'Берёзовая роща',
            'Старая гончарная мастерская',
            'Заброшенный аэродром',
            'Поляна с валунами-следовиками',
            'Старая сторожевая вышка',
            'Заброшенный дом смотрителя',
            'Кратер потухшего вулкана',
            'Старая табачная фабрика',
            'Заброшенная водокачка',
            'Поляна с древними петроглифами',
            'Старая башня-голубятня',
            'Заброшенный форт',
            'Термальные источники',
            'Старая типография',
            'Заброшенная лодочная станция',
            'Поляна с мегалитами',
            'Старая ледниковая пещера',
            'Заброшенная электростанция',
            'Холм с курганами',
            'Старая пограничная застава',
            'Заброшенная усадьба',
            'Поляна с дикими яблонями',
            'Старая звонница',
            'Заброшенный дом культуры',
            'Карстовая воронка',
            'Старая сыроварня'
        ];

        const actions = [
            'Нарисуй три абстрактных символа',
            'Сфотографируй что-то синее',
            'Напиши короткое стихотворение',
            'Найди и собери пять разных листьев',
            'Построй маленькую пирамиду из камней',
            'Оставь послание будущему путешественнику',
            'Запиши три звука, которые слышишь',
            'Сделай скетч окружающего пейзажа',
            'Придумай легенду об этом месте',
            'Найди самый необычный предмет',
            'Напиши короткое стихотворение о том, что видишь',
            'Оставь послание для следующего путника',
            'Создай временную скульптуру из природных материалов',
            'Запиши звуки этого места на 60 секунд',
            'Нарисуй карту местности от руки',
            'Найди и сфотографируй три разных текстуры',
            'Медитируй 10 минут в полной тишине',
            'Собери коллекцию из 7 мелких предметов',
            'Сделай селфи с необычного ракурса',
            'Найди что-то старое и сфотографируй детали',
            'Создай мандалу из найденных объектов',
            'Запиши три самых громких и три самых тихих звука',
            'Нарисуй портрет незнакомца',
            'Сфотографируй игру света и тени',
            'Напиши письмо самому себе в будущее',
            'Найди идеальный камень и оставь на нём знак',
            'Создай инсталляцию из веток',
            'Запиши свои ощущения всеми пятью чувствами',
            'Сфотографируй что-то, что другие не замечают',
            'Построй миниатюрный каменный алтарь',
            'Нарисуй то, что чувствуешь, а не то, что видишь',
            'Найди и запечатлей три оттенка одного цвета',
            'Создай узор из листьев',
            'Запиши историю этого места (вымышленную)',
            'Сфотографируй отражение',
            'Найди природный объект в форме буквы',
            'Создай венок или гирлянду',
            'Нарисуй автопортрет не глядя',
            'Сфотографируй движение',
            'Найди самое старое и самое новое',
            'Создай ловца снов из природных материалов',
            'Запиши три желания и спрячь записку',
            'Сфотографируй симметрию',
            'Найди след присутствия животного',
            'Создай компас из камней',
            'Нарисуй облака',
            'Сфотографируй контраст',
            'Найди что-то круглое в природе',
            'Создай спираль из камней',
            'Запиши легенду об этом месте',
            'Сфотографируй пустоту',
            'Найди растение и изучи его 5 минут',
            'Создай рамку из природных материалов',
            'Нарисуй лабиринт',
            'Сфотографируй цикл или паттерн',
            'Найди точку с лучшим видом',
            'Создай знак из палочек',
            'Запиши диалог с местом',
            'Сфотографируй хаос и порядок',
            'Найди следы времени',
            'Создай солнечные часы',
            'Нарисуй дверь в другой мир',
            'Сфотографируй переход',
            'Найди что-то пушистое',
            'Создай гнездо',
            'Запиши три вещи, за которые благодарен',
            'Сфотографируй жизнь',
            'Найди геометрическую форму',
            'Создай тотем из камней',
            'Нарисуй дорогу домой',
            'Сфотографируй тайну',
            'Найди что-то красное',
            'Создай указатель для путников',
            'Запиши звук ветра',
            'Сфотографируй заброшенность',
            'Найди лицо в текстуре',
            'Создай мост из палок',
            'Нарисуй дерево жизни',
            'Сфотографируй одиночество',
            'Найди самое высокое и самое низкое',
            'Создай круг силы',
            'Запиши свой манифест',
            'Сфотографируй надежду',
            'Найди источник воды',
            'Создай гирлянду из природных объектов',
            'Нарисуй путь солнца',
            'Сфотографируй свободу',
            'Найди четыре элемента (огонь, вода, земля, воздух)',
            'Создай алфавит из веток',
            'Запиши секрет этого места',
            'Сфотографируй разрушение',
            'Найди что-то мягкое',
            'Создай карту сокровищ',
            'Нарисуй энергию места',
            'Сфотографируй возрождение',
            'Найди точку равновесия',
            'Создай портал из камней',
            'Запиши то, чего не видно',
            'Сфотографируй время',
            'Найди три вещи одного размера',
            'Создай оберег',
            'Нарисуй карту звёзд (днём)',
            'Сфотографируй красоту в упадке',
            'Найди самое древнее',
            'Создай жертвенник красоте',
            'Запиши молитву месту',
            'Сфотографируй пустоту, полную смысла',
            'Найди границу миров'
        ];

        const conditions = [
            'Используй только предметы, найденные на месте',
            'Не используй телефон',
            'Выполни до заката',
            'Делай всё левой рукой',
            'Не произноси ни слова',
            'Закрой глаза на 1 минуту перед началом',
            'Сделай всё за 5 минут',
            'Не оглядывайся назад',
            'Выполни босиком (если безопасно)',
            'Повтори действие три раза',
            'Выполни в полном одиночестве',
            'Сделай всё за 15 минут',
            'Не разговаривай всё время пребывания',
            'Приди на рассвете',
            'Выполни в полной темноте',
            'Не оставляй следов своего присутствия',
            'Приди после дождя',
            'Босиком',
            'С завязанными глазами (кроме фото)',
            'Только в одиночку, без свидетелей',
            'Приди в полнолуние',
            'Не фотографируй, только рисуй',
            'Приди в самое холодное время суток',
            'Используй только левую руку',
            'Не поворачивайся спиной к входу',
            'Приди в первый снег',
            'Двигайся только по часовой стрелке',
            'Приди в самый жаркий час',
            'Не произноси ни слова вслух',
            'Работай только с закрытыми глазами',
            'Приди во время грозы',
            'Используй только то, что помещается в кармане',
            'Не оглядывайся назад',
            'Приди в туман',
            'Всё делай в обратном порядке',
            'Не сиди и не ложись',
            'Приди в свой день рождения',
            'Работай только недоминантной рукой',
            'Не касайся земли руками',
            'Приди ровно в полдень',
            'Оставайся в движении всё время',
            'Не смотри на часы',
            'Приди в первый день весны',
            'Используй только три цвета',
            'Держи один глаз закрытым',
            'Приди в последний день осени',
            'Не используй никаких инструментов',
            'Уйди до того, как встретишь человека',
            'Приди в самый короткий день года',
            'Работай только тенью',
            'Не ступай на тропы',
            'Приди в новолуние',
            'Действуй как можно медленнее',
            'Не смотри вниз',
            'Приди за час до заката',
            'Дыши только через нос',
            'Не используй красный цвет',
            'Приди когда дует северный ветер',
            'Двигайся только боком',
            'Не касайся ничего искусственного',
            'Приди в годовщину важного события',
            'Работай только со звуком',
            'Не показывай зубы (не улыбайся)',
            'Приди когда цветёт определённое растение',
            'Используй только симметрию',
            'Не ешь и не пей там',
            'Приди когда солнце в зените',
            'Работай только с белым',
            'Не наступай на трещины',
            'Приди в день равноденствия',
            'Держи что-то в зубах всё время',
            'Не используй прямых линий',
            'Приди когда идёт снег',
            'Работай только с тем, что движется',
            'Не произноси название места вслух',
            'Приди в день солнцестояния',
            'Используй только круги',
            'Не поворачивайся к солнцу спиной',
            'Приди когда услышишь зов',
            'Работай только с отражениями',
            'Не оставляй отпечатков пальцев',
            'Приди босиком по росе',
            'Используй только чёрное и белое',
            'Не закрывай оба глаза одновременно',
            'Приди когда луна на горизонте',
            'Работай только с запахами',
            'Не возвращайся тем же путём',
            'Приди в свой звёздный час',
            'Дыши в такт с ветром',
            'Не создавай острых углов',
            'Приди когда температура ноль',
            'Работай только с тишиной',
            'Не отбрасывай тень на творение',
            'Приди седьмого числа',
            'Используй только спирали',
            'Не смотри на небо',
            'Приди когда число совпадает с фазой луны',
            'Работай только с эхом',
            'Не пересекай воду',
            'Приди в сумерки',
            'Используй только нечётные числа',
            'Не прикасайся к металлу',
            'Приди когда нет ветра',
            'Работай только со своей тенью',
            'Не оставляй ничего после себя, кроме задания',
            'Приди в первый заморозок',
            'Используй только то, что создано природой',
            'Не говори "я"',
            'Приди когда зацветёт луна (очень редко)'
        ];

        function generateQuest() {
            console.log('🎲 Генерирую квест...');
            showLoader();

            setTimeout(() => {
                currentQuest = {
                    place: places[Math.floor(Math.random() * places.length)],
                    action: actions[Math.floor(Math.random() * actions.length)],
                    condition: conditions[Math.floor(Math.random() * conditions.length)],
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };

                document.getElementById('questPlace').textContent = currentQuest.place;
                document.getElementById('questAction').textContent = currentQuest.action;
                document.getElementById('questCondition').textContent = currentQuest.condition;
                document.getElementById('questNumber').textContent = journal.length + 1;
                document.getElementById('questCard').classList.remove('hidden');

                journal.push(currentQuest);
                saveJournal();
                updateStats();
                hideLoader();
                showNotification('🎉 Новое приключение готово!');
            }, 500);
        }

        function completeQuest() {
            console.log('✅ Завершаю квест...');
            if (!currentQuest) {
                showNotification('❌ Сначала создайте квест!');
                return;
            }

            const index = journal.findIndex(q => q.id === currentQuest.id);
            if (index !== -1) {
                journal[index].status = 'completed';
                journal[index].completedAt = new Date().toISOString();
                saveJournal();
                updateStats();
                showNotification('✅ Квест выполнен!');
                confetti();
            }
        }

        function exportQuest() {
            console.log('📄 Экспортирую...');
            if (!currentQuest) {
                showNotification('❌ Сначала создайте квест!');
                return;
            }

            const text = `🗺️ МИКРО-ПРИКЛЮЧЕНИЕ #${journal.length}\n\n📍 Место: ${currentQuest.place}\n⚡ Действие: ${currentQuest.action}\n🎯 Условие: ${currentQuest.condition}`;
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `quest-${journal.length}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('📄 Квест экспортирован!');
        }

        function shareQuest() {
            console.log('🔗 Делюсь...');
            if (!currentQuest) {
                showNotification('❌ Сначала создайте квест!');
                return;
            }

            const text = `🗺️ Моё новое приключение!\n\n📍 ${currentQuest.place}\n⚡ ${currentQuest.action}\n🎯 ${currentQuest.condition}`;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('📋 Квест скопирован в буфер обмена!');
                });
            } else {
                showNotification('📋 ' + text);
            }
        }

        function toggleJournal() {
            const panel = document.getElementById('journalPanel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden')) {
                renderJournal();
            }
        }

        function renderJournal() {
            const content = document.getElementById('journalContent');
            
            if (journal.length === 0) {
                content.innerHTML = '<p class="empty-state">Ваши приключения появятся здесь...<br>🗺️<br>Создайте первый квест!</p>';
            return;
            }

            content.innerHTML = journal.slice().reverse().map(quest => `
                <div class="journal-entry ${quest.status}">
                    <div class="journal-entry-header">
                        <span class="journal-entry-date">
                            ${new Date(quest.timestamp).toLocaleDateString('ru-RU', {
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </span>
                        <span class="journal-entry-status ${quest.status}">
                            ${quest.status === 'completed' ? '✓ Выполнено' : '⏳ В процессе'}
                        </span>
                    </div>
                    <div class="journal-entry-content">
                        <strong>📍 ${quest.place}</strong>
                        ⚡ ${quest.action}<br>
                        🎯 ${quest.condition}
                        ${quest.completedAt ? `<br><small style="color: var(--text-secondary); margin-top: 8px; display: block;">Завершено: ${new Date(quest.completedAt).toLocaleString('ru-RU')}</small>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function clearJournal() {
            if (confirm('⚠️ Вы уверены? Все приключения будут удалены безвозвратно!')) {
                journal = [];
                saveJournal();
                renderJournal();
                updateStats();
                showNotification('🗑️ Журнал очищен');
            }
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            document.getElementById('themeIcon').textContent = next === 'dark' ? '🌙' : '☀️';
            localStorage.setItem('theme', next);
            showNotification(`Тема: ${next === 'dark' ? 'тёмная' : 'светлая'}`);
        }

        function saveJournal() {
            localStorage.setItem('adventureJournal', JSON.stringify(journal));
        }

        function updateStats() {
            const completed = journal.filter(q => q.status === 'completed').length;
            const places = new Set(journal.map(q => q.place)).size;
            
            document.getElementById('totalQuests').textContent = journal.length;
            document.getElementById('completedQuests').textContent = completed;
            document.getElementById('uniquePlaces').textContent = places;
        }

        function showNotification(text) {
            const notif = document.getElementById('notification');
            notif.textContent = text;
            notif.classList.remove('hidden');
            setTimeout(() => notif.classList.add('hidden'), 3000);
        }

        function showLoader() {
            document.getElementById('loader').classList.remove('hidden');
        }

        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
        }

        function confetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#ff6b6b', '#51cf66'];
            const emojis = ['🎉', '🎊', '⭐', '✨', '🌟', '💫'];
    
            for (let i = 0; i < 80; i++) {
                const isEmoji = Math.random() > 0.7;
                const div = document.createElement('div');

                div.style.position = 'fixed';
                div.style.left = Math.random() * 100 + '%';
                div.style.top = '-20px';
                div.style.zIndex = '10000';
                div.style.pointerEvents = 'none';
                div.style.fontSize = '20px';
        
                if (isEmoji) {
                   div.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                } else {
                    div.style.width = '10px';
                    div.style.height = '10px';
                    div.style.background = colors[Math.floor(Math.random() * colors.length)];
                    div.style.borderRadius = '50%';
                }
        
                document.body.appendChild(div);

                const rotation = Math.random() * 720 - 360;
                const xMovement = Math.random() * 200 - 100;
        
                div.animate([
                    { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
                    { transform: `translate(${xMovement}px, ${window.innerHeight + 50}px) rotate(${rotation}deg)`, opacity: 0 }
                ], {
                    duration: 2000 + Math.random() * 1000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                }).onfinish = () => div.remove();
            }
        }

        updateStats();
        
        const hour = new Date().getHours();
        const savedTheme = localStorage.getItem('theme') || (hour >= 6 && hour < 18 ? 'light' : 'dark');
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? '🌙' : '☀️';

        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        for (let i = 0; i < 100; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 3 + 1,
                speedX: Math.random() * 0.5 - 0.25,
                speedY: Math.random() * 0.5 - 0.25
            });
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.x += p.speedX;
                p.y += p.speedY;
                if (p.x < 0) p.x = canvas.width;
                if (p.x > canvas.width) p.x = 0;
                if (p.y < 0) p.y = canvas.height;
                if (p.y > canvas.height) p.y = 0;
                
                ctx.fillStyle = 'rgba(102, 126, 234, 0.5)';
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(animate);
        }
        animate();

        let secretCode = [];
        const secretSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];

        document.addEventListener('keydown', (e) => {
            secretCode.push(e.key);
            secretCode = secretCode.slice(-6);
    
            if (JSON.stringify(secretCode) === JSON.stringify(secretSequence)) {
                openCreator();
                secretCode = [];
            }
        });

        function openCreator() {
            document.getElementById('creatorMode').classList.remove('hidden');
            showNotification('🎨 Режим создателя активирован! (bezff code)');
            renderCustomContent();
        }

        function closeCreator() {
            document.getElementById('creatorMode').classList.add('hidden');
        }

        function addCustomContent() {
            const place = document.getElementById('newPlace').value.trim();
            const action = document.getElementById('newAction').value.trim();
            const condition = document.getElementById('newCondition').value.trim();

            if (!place && !action && !condition) {
                showNotification('❌ Заполните хотя бы одно поле!');
                return;
            }

            const custom = JSON.parse(localStorage.getItem('customContent') || '{"places":[],"actions":[],"conditions":[]}');

            if (place && !custom.places.includes(place)) {
                custom.places.push(place);
                places.push(place);
            }
            if (action && !custom.actions.includes(action)) {
                custom.actions.push(action);
                actions.push(action);
            }
            if (condition && !custom.conditions.includes(condition)) {
                custom.conditions.push(condition);
                conditions.push(condition);
            }

           localStorage.setItem('customContent', JSON.stringify(custom));
    
            document.getElementById('newPlace').value = '';
            document.getElementById('newAction').value = '';
            document.getElementById('newCondition').value = '';
            
            showNotification('✅ Контент добавлен! Теперь он появится в квестах');
            renderCustomContent();
        }

        function renderCustomContent() {
            const custom = JSON.parse(localStorage.getItem('customContent') || '{"places":[],"actions":[],"conditions":[]}');
            const listEl = document.getElementById('customList');

            const total = custom.places.length + custom.actions.length + custom.conditions.length;
            
            if (total === 0) {
                listEl.innerHTML = '<p class="empty-state" style="padding: 20px;">Вы ещё не добавили свой контент</p>';
            return;
            }

            let html = '<h3 style="margin-bottom: 16px; color: var(--text-secondary);">📚 Ваш контент:</h3>';
    
            custom.places.forEach(item => {
                html += `<div class="custom-item">
                    <span class="custom-item-text">${item}</span>
                    <span class="custom-item-badge">📍 Место</span>
                </div>`;
            });
    
            custom.actions.forEach(item => {
                html += `<div class="custom-item">
                    <span class="custom-item-text">${item}</span>
                    <span class="custom-item-badge">⚡ Действие</span>
                </div>`;
            });
    
            custom.conditions.forEach(item => {
                html += `<div class="custom-item">
                    <span class="custom-item-text">${item}</span>
                    <span class="custom-item-badge">🎯 Условие</span>
                </div>`;
            });
    
            listEl.innerHTML = html;
        }

        (function loadCustomContent() {
            const custom = JSON.parse(localStorage.getItem('customContent') || '{"places":[],"actions":[],"conditions":[]}');
            places.push(...custom.places);
            actions.push(...custom.actions);
            conditions.push(...custom.conditions);
        })();


        console.log('✅ Всё готово к работе!');
    </script>
</body>
</html>